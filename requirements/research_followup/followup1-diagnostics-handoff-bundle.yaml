phase_id: diagnostics-handoff-bundle
run_id: autopack-diagnostics-parity-v1
chunk_number: followup-1
description: |
  Diagnostics Parity (Stage 1A): Deterministic handoff bundle generator.

  Generate a stable, reproducible `handoff/` folder from a run directory:
  - index.json (manifest of artifacts)
  - summary.md (high-signal narrative)
  - excerpts/ (tailed/snippets)

goals:
  - Create deterministic bundle artifacts for a given run directory (no randomness)
  - Never crash if artifacts are missing (degrade gracefully)
  - Keep model/token usage at 0 (purely deterministic generator)

deliverables:
  code:
    - src/autopack/diagnostics/handoff_bundler.py
    - src/autopack/cli/commands/handoff.py
  tests:
    - tests/autopack/diagnostics/test_handoff_bundler.py
  docs:
    - docs/autopack/diagnostics_handoff_bundle.md

features:
  - Locate run directory via RunFileLayout (or equivalent canonical mapping)
  - Enumerate canonical artifacts (run summary, phase summaries, diagnostics output, error reports)
  - Write:
    - handoff/index.json with {path, kind, bytes, sha256, rationale}
    - handoff/summary.md
    - handoff/excerpts/* with bounded tails (<=120 lines each by default)

validation:
  functional:
    - Works with missing/partial artifacts (bundle includes "missing" entries)
    - index.json is stable across repeated runs (same input dir => same output bytes)
    - Excerpts are bounded by configured caps
  quality:
    - â‰¥10 unit tests passing
    - No network calls, no LLM calls


