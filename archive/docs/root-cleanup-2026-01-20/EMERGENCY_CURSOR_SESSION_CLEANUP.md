# Emergency Cursor Session Cleanup

## The Problem

After restart, the invisible Cursor windows **reappeared**. This means they're stored in Cursor's **session restoration data**, not just in memory or processes.

Cursor saves which windows were open and tries to restore them on restart. Those invisible windows are in that list.

## The Solution

We need to **delete Cursor's session storage files** so it starts fresh with no persisted windows.

## Steps to Fix This

### Step 1: Close Cursor Completely

**IMPORTANT: Close ALL Cursor windows first!**

- Close your main Cursor chat window
- Close any other Cursor windows
- Verify Cursor is completely closed (check Task Manager)

### Step 2: Run the Session Cleaner Script

Once Cursor is fully closed, run:

```powershell
cd C:\dev\Autopack
.\scripts\clean_cursor_session.ps1
```

What it does:
- ✅ Verifies Cursor is closed (won't run if it's open)
- ✅ Deletes Session Storage files (where window list is stored)
- ✅ Deletes Local Storage files (per-workspace state)
- ✅ This forces Cursor to start fresh next time

### Step 3: Reopen Cursor

After the script completes:
- Open Cursor normally
- **It should open with ONLY your main window**
- No invisible windows should reappear

### Step 4: Test Auto-Fill

Once Cursor is open with just the main window:

```batch
cd C:\dev\Autopack
auto_fill_empty_slots.bat
```

Watch for:
- ✅ New Cursor windows appear in grid slots
- ✅ They are VISIBLE (not hidden)
- ✅ They are positioned correctly
- ✅ Your main window stays open

## What Gets Deleted

The script deletes these files in `%APPDATA%\Cursor`:

```
Session Storage/
  *.log      (session log files)
  *.ldb      (session data files)

Local Storage/leveldb/
  *.log      (workspace state logs)
  *.ldb      (workspace state data)
```

These are **safe to delete**:
- They're auto-generated by Cursor
- Cursor will recreate them on next launch
- No user data is lost (editors, settings, etc. are stored elsewhere)

## Important Notes

⚠️ **Cursor MUST be closed** before running the cleanup script
- The script will check and refuse to run if Cursor is open
- This prevents conflicts with file access

✅ **Safe to run multiple times**
- Can't hurt anything if run multiple times
- Will just report "not found" if already cleaned

## If This Still Doesn't Work

If invisible windows **still** reappear after cleanup:

1. **The session files might be in a different location**
   - Run: `.\scripts\debug_cursor_windows.ps1` to verify state

2. **Cursor might be recreating them automatically**
   - Check Cursor's settings for "Restore windows on startup"
   - Disable if found

3. **There might be a startup script**
   - Check for `.bat` or `.ps1` files that launch Cursor
   - Verify they're not opening hidden windows

## Quick Reference

```powershell
# Close Cursor first! (most important step)

# Clean the session
cd C:\dev\Autopack
.\scripts\clean_cursor_session.ps1

# Reopen Cursor
# (it should start fresh)

# Test auto-fill
cd C:\dev\Autopack
auto_fill_empty_slots.bat
```

## Troubleshooting

**Q: Script says "Cursor is still running"**
A: Close all Cursor windows and try again

**Q: Script runs but windows still reappear**
A: There might be additional session files in:
   - `%APPDATA%\Local\Cursor`
   - `%LOCALAPPDATA%\cursor-user-data`
   - Check these locations for Session Storage folders

**Q: I accidentally deleted something important**
A: Don't worry - session files are auto-generated
   - Just reopen Cursor, it will recreate them
   - Your work/settings are saved elsewhere

## Next Steps

1. **Close Cursor NOW** (if still open)
2. **Run the cleanup script** (in PowerShell as admin if needed)
3. **Reopen Cursor**
4. **Test auto_fill**
5. **Report results**

---

Ready to clean up? Let me know if you hit any issues!
