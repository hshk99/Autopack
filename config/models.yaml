complexity_models:
  low:
    builder: glm-4.5-20250101
    auditor: glm-4.5-20250101
  medium:
    builder: gemini-2.5-pro
    auditor: gemini-2.5-pro
  high:
    builder: claude-sonnet-4-5
    auditor: claude-sonnet-4-5
    escalation_builder: gpt-5
    escalation_auditor: claude-opus-4-5
llm_routing_policies:
  security_auth_change:
    strategy: best_first
    builder_primary: gpt-5
    auditor_primary: claude-opus-4-5
    secondary_auditor: gpt-5
    dual_audit: true
    description: Authentication, authorization, security code changes
  external_feature_reuse_remote:
    strategy: best_first
    builder_primary: gpt-5
    auditor_primary: claude-opus-4-5
    dual_audit: true
    allow_auto_apply: false
    description: Pull code from unvetted GitHub/NPM/PyPI/external sources
  schema_contract_change_destructive:
    strategy: best_first
    builder_primary: gpt-5
    auditor_primary: claude-opus-4-5
    dual_audit: true
    max_attempts: 2
    description: Drop columns/tables, change constraints, destructive migrations
  external_feature_reuse_internal:
    strategy: progressive
    builder_primary: glm-4.5-20250101
    auditor_primary: claude-sonnet-4-5
    escalate_to:
      builder: gpt-5
      auditor: claude-opus-4-5
      after_attempts: 2
    description: Reuse from internal templates, vetted repos, internal modules
  schema_contract_change_additive:
    strategy: progressive
    builder_primary: glm-4.5-20250101
    auditor_primary: claude-sonnet-4-5
    escalate_to:
      builder: gpt-5
      auditor: claude-opus-4-5
      after_attempts: 1
    description: Add nullable columns, indexes, views (backwards-compatible)
  core_backend_high:
    strategy: progressive
    builder_primary: glm-4.5-20250101
    auditor_primary: claude-sonnet-4-5
    escalate_to:
      builder: gpt-5
      auditor: claude-opus-4-5
      after_attempts: 2
    description: Large refactors, complex features (non-security, non-schema)
  docs:
    strategy: cheap_first
    builder_primary: glm-4.5-20250101
    auditor_primary: glm-4.5-20250101
    escalate_to:
      builder: glm-4.5-20250101
      after_attempts: 3
    description: Documentation generation, README updates
  tests:
    strategy: cheap_first
    builder_primary: claude-sonnet-4-5
    auditor_primary: glm-4.5-20250101
    escalate_to:
      builder: gpt-5
      after_attempts: 2
    description: Test code generation, test refactoring
category_models:
  external_feature_reuse:
    description: 'DEPRECATED: Use external_feature_reuse_remote or _internal'
    builder_model_override: gpt-5
    auditor_model_override: claude-opus-4-5
  security_auth_change:
    description: Security or auth code changes
    builder_model_override: gpt-5
    auditor_model_override: claude-opus-4-5
    secondary_auditor: gpt-5
  schema_contract_change:
    description: 'DEPRECATED: Use schema_contract_change_destructive or _additive'
    builder_model_override: gpt-5
    auditor_model_override: claude-opus-4-5
  tests:
    builder_model_override: glm-4.5-20250101
provider_quotas:
  openai:
    weekly_token_cap: 50000000
    soft_limit_ratio: 0.8
  anthropic:
    weekly_token_cap: 10000000
    soft_limit_ratio: 0.8
  google:
    weekly_token_cap: 30000000
    soft_limit_ratio: 0.8
quota_enforcement:
  best_first_block_on_exhaustion: true
  progressive_block_on_exhaustion: true
  cheap_first_allow_downgrade: false
  on_quota_exhaustion: raise_incident
  never_fallback_categories:
  - security_auth_change
  - external_feature_reuse_remote
  - schema_contract_change_destructive
quota_routing:
  enabled: true
  never_fallback_categories:
  - external_feature_reuse
  - security_auth_change
  - schema_contract_change
fallback_strategy:
  by_category:
    general:
      fallbacks:
      - gemini-2.5-pro
      - gpt-4o
    tests:
      fallbacks:
      - gemini-2.5-pro
      - gpt-4o
    docs:
      fallbacks:
      - gemini-2.5-pro
      - gpt-4o
  default_fallbacks:
  - gemini-2.5-pro
  - gpt-4o
defaults:
  high_risk_builder: glm-4.5-20250101
  high_risk_auditor: glm-4.5-20250101
model_aliases:
  glm: glm-4.5-20250101
  sonnet: claude-sonnet-4-5
  opus: claude-opus-4-5
  gemini: gemini-2.5-pro
  gemini-flash: gemini-2.5-flash
  gemini-lite: gemini-2.5-flash-lite
escalation_chains:
  builder:
    low:
      models:
      - glm-4.5-20250101
      - gemini-2.5-pro
      - claude-sonnet-4-5
    medium:
      models:
      - gemini-2.5-pro
      - claude-sonnet-4-5
      - gpt-5
    high:
      models:
      - claude-sonnet-4-5
      - gpt-5
  auditor:
    low:
      models:
      - glm-4.5-20250101
      - gemini-2.5-pro
    medium:
      models:
      - gemini-2.5-pro
      - claude-sonnet-4-5
    high:
      models:
      - claude-sonnet-4-5
      - claude-opus-4-5
complexity_escalation:
  enabled: true
  thresholds:
    low_to_medium: 2
    medium_to_high: 2
  max_attempts_per_phase: 5
  failure_types:
  - auditor_reject
  - ci_fail
  - patch_apply_error
replan:
  trigger_threshold: 2
  message_similarity_enabled: true
  similarity_threshold: 0.8
  min_message_length: 30
  max_replans_per_phase: 1
  max_replans_per_run: 5
  fatal_error_types:
  - wrong_tech_stack
  - schema_mismatch
  - api_contract_wrong
doctor_models:
  cheap: glm-4.5-20250101
  strong: claude-sonnet-4-5
  min_confidence_for_cheap: 0.7
  health_budget_near_limit_ratio: 0.8
  max_builder_attempts_before_complex: 4
  high_risk_categories:
  - import
  - logic
  low_risk_categories:
  - encoding
  - network
  - file_io
  - validation
  # Phase 3: execute_fix configuration (GPT_RESPONSE9)
  # Allows Doctor to execute infrastructure-level fixes directly
  allow_execute_fix_global: false  # SECURITY: Disabled by default (user opt-in)
  max_execute_fix_per_phase: 1     # Limit attempts to prevent loops
  allowed_fix_types:               # Command categories Doctor can suggest
  - git                            # git checkout, reset, stash, merge --abort
  - file                           # rm -f, mkdir -p, mv, cp
  # - python                       # pip install (uncomment if needed)
  # - docker                       # docker restart (future)
  # - shell                        # generic shell (future, high risk)
discovery_promotion:
  enabled: false
  min_runs_for_candidate: 3
  window_days: 30
  min_severity_for_candidate: medium
  min_runs_for_rule: 5
  min_projects_for_rule: 2
  require_human_approval: true
