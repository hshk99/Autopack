# Autopack Memory Configuration
# See docs/IMPLEMENTATION_PLAN_MEMORY_AND_CONTEXT.md for details

# Master switch for vector memory
enable_memory: true

# Backend selection: qdrant (default) or faiss (dev/offline)
use_qdrant: true

# Qdrant configuration (default vector backend)
qdrant:
  host: localhost
  port: 6333
  api_key: ""  # Optional API key for Qdrant Cloud
  prefer_grpc: false  # Use HTTP by default
  timeout: 60  # Request timeout in seconds
  # Pinned Qdrant image for autostart fallback (determinism).
  # Must match docker-compose.yml; use AUTOPACK_QDRANT_IMAGE env to override.
  image: "qdrant/qdrant:v1.12.5"
  # Operational policy:
  # - require=false: Qdrant is optional; Autopack should still run (FAISS fallback)
  # - fallback_to_faiss=true: if Qdrant is unreachable, use FAISS automatically
  require: false
  fallback_to_faiss: true
  # If Qdrant is configured but not running, Autopack can attempt to start it automatically
  # (via docker compose / docker run) and wait briefly for readiness.
  autostart: true
  autostart_timeout_seconds: 15

# FAISS fallback configuration (for offline/dev environments)
faiss_index_path: ".autonomous_runs/file-organizer-app-v1/.faiss"

# Number of top results to retrieve for prompts
top_k_retrieval: 5

# Maximum characters to embed (OpenAI limit ~8191 tokens)
max_embed_chars: 30000

# TTL for memory entries in days (prune older entries)
ttl_days: 30

# Planning artifacts/plan changes collection
planning_collection: "planning"
planning_keep_versions: 3

# Collections configuration
collections:
  code_docs:
    description: "Workspace file embeddings"
    ttl_days: 90  # Keep code docs longer
  run_summaries:
    description: "Per-phase summaries"
    ttl_days: 30
  errors_ci:
    description: "CI/test failure snippets"
    ttl_days: 14  # Errors can be pruned faster
  doctor_hints:
    description: "Doctor hints and outcomes"
    ttl_days: 30

# Goal-drift detection (advisory mode)
goal_drift:
  enabled: true
  mode: advisory  # advisory (log only) or blocking (fail on drift)
  threshold: 0.7  # Similarity threshold below which drift is flagged

# IMP-LOOP-017: Automated memory maintenance scheduling
# Prevents stale insights from polluting retrieval context
maintenance:
  auto_maintenance_enabled: true  # Master switch for automatic maintenance
  maintenance_interval_hours: 24  # Hours between maintenance runs
  max_age_days: 90  # Maximum age for entries before pruning
  prune_threshold: 1000  # Max entries per collection before aggressive pruning
  planning_keep_versions: 3  # Number of planning artifact versions to retain
