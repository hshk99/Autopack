{
  "phases": [
    {
      "id": "hardening-auth",
      "description": "Harden authentication: RBAC, password reset/verification hooks, protected routes, logout/session handling, and auth E2E coverage.",
      "task_category": "backend",
      "complexity": "high",
      "builder_mode": "structured_edit",
      "features": ["auth", "frontend"],
      "acceptance_criteria": [
        "RBAC enforced on sensitive routes; logout/session handled.",
        "Password reset and email verification hooks present (stubbed if external service not configured).",
        "Frontend login/register/reset flows covered by tests; protected routes enforced.",
        "Auth E2E tests pass for login/register/reset/protected pages."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/models/",
          "backend/tests/",
          "backend/migrations/",
          "frontend/src/"
        ],
        "read_only_context": [
          "backend/db/",
          "backend/services/"
        ]
      }
    },
    {
      "id": "hardening-search-quality",
      "description": "Improve search relevance and UX: tuning, pagination, facets, and E2E coverage for advanced search.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["search", "frontend"],
      "acceptance_criteria": [
        "Search supports pagination, facets/filters, and relevance tuning (recency/category boosts).",
        "Exports and empty-state UX verified; E2E search tests with seeded fixtures pass.",
        "Indexes/caching added for acceptable latency."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/",
          "frontend/src/"
        ],
        "read_only_context": [
          "backend/db/",
          "backend/models/"
        ]
      }
    },
    {
      "id": "hardening-batch-observability",
      "description": "Add batch job observability: status endpoints, per-file errors, cancel/retry, structured logging/metrics, and E2E coverage.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["batch", "search", "frontend"],
      "acceptance_criteria": [
        "Batch status endpoints expose progress/errors; cancel/retry supported.",
        "Structured logging/metrics for batches added.",
        "E2E tests cover success/failure/cancel paths."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/",
          "frontend/src/"
        ],
        "read_only_context": [
          "backend/db/",
          "backend/services/"
        ]
      }
    },
    {
      "id": "hardening-file-safety",
      "description": "Implement file safety: type/size enforcement, MIME sniffing, virus-scan hook, safe temp storage, and tests for blocked uploads.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["upload", "batch"],
      "acceptance_criteria": [
        "Uploads enforce file type/size; MIME sniffing guards added.",
        "Virus-scan hook integrated; unsafe files blocked with clear errors.",
        "Tests cover blocked uploads and quarantine paths."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/"
        ],
        "read_only_context": [
          "backend/uploads/",
          "backend/services/"
        ]
      }
    },
    {
      "id": "hardening-storage-config",
      "description": "Abstract storage (local/S3), add presigned URL support, and document configuration/migration steps.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["upload", "batch"],
      "acceptance_criteria": [
        "Storage layer supports local and S3 via config; presigned URLs available.",
        "Migration/compat tests for localâ†’S3 paths added.",
        "Ops docs updated for storage configuration."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/",
          "backend/config/"
        ],
        "read_only_context": [
          "backend/services/"
        ]
      }
    },
    {
      "id": "hardening-export-sharing",
      "description": "Enhance exports/sharing: filtered/batch exports, expiring share links, and audit trail for shares.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["search", "export", "frontend"],
      "acceptance_criteria": [
        "Filtered and batch exports supported; share links have expiry and audit trail.",
        "API/UI paths tested; audit records captured.",
        "Docs updated for sharing/exports behavior."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/",
          "frontend/src/"
        ],
        "read_only_context": [
          "backend/db/"
        ]
      }
    },
    {
      "id": "hardening-ui-ux-polish",
      "description": "Polish UI/UX: accessibility, keyboard nav, loading/error states, responsive layouts, and toasts/validation for key flows.",
      "task_category": "frontend",
      "complexity": "low",
      "builder_mode": "structured_edit",
      "features": ["frontend", "auth", "search", "batch"],
      "acceptance_criteria": [
        "Key flows have loading/error states and toasts/inline validation.",
        "Responsive layouts verified; basic a11y/keyboard navigation in place.",
        "Frontend tests cover the updated UI states."
      ],
      "scope": {
        "paths": [
          "frontend/src/"
        ],
        "read_only_context": [
          "frontend/package.json"
        ]
      }
    },
    {
      "id": "hardening-logging-metrics",
      "description": "Add structured logging and basic metrics (latency/counts/errors) for auth/search/batch; expose diagnostics in health endpoints.",
      "task_category": "backend",
      "complexity": "low",
      "builder_mode": "structured_edit",
      "features": ["auth", "search", "batch"],
      "acceptance_criteria": [
        "Structured logs include request/phase IDs for auth/search/batch.",
        "Basic metrics recorded and surfaced via health/diagnostic endpoints.",
        "Tests confirm logging/metrics emit for key endpoints."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/"
        ],
        "read_only_context": [
          "backend/services/"
        ]
      }
    },
    {
      "id": "hardening-backup-migrations",
      "description": "Validate migration ordering/rollback, add seed data for smoke envs, and document backup/restore procedure.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["auth", "data"],
      "acceptance_criteria": [
        "Migrations apply/rollback cleanly in sequence; ordering documented.",
        "Seed data available for smoke; tests cover migration safety.",
        "Backup/restore steps documented and smoke-tested."
      ],
      "scope": {
        "paths": [
          "backend/migrations/",
          "backend/models/",
          "backend/tests/"
        ],
        "read_only_context": [
          "backend/db/"
        ]
      }
    },
    {
      "id": "hardening-e2e-smoke",
      "description": "Add an automated E2E smoke suite covering auth, upload/search, batch status, export, and logout.",
      "task_category": "tests",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["auth", "search", "batch", "frontend"],
      "acceptance_criteria": [
        "E2E tests (API/UI) cover auth, upload/search, batch status, export, logout.",
        "Suite runs in CI with seeded data and passes.",
        "Failures produce saved artifacts/logs for debugging."
      ],
      "scope": {
        "paths": [
          "tests/",
          "scripts/"
        ],
        "read_only_context": [
          "backend/",
          "frontend/"
        ]
      }
    },
    {
      "id": "hardening-security-basics",
      "description": "Add security hardening: rate limiting on auth/upload/search, CORS/headers tightening, and secret/config audit.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["auth", "upload", "search"],
      "acceptance_criteria": [
        "Rate limiting applied to auth/upload/search endpoints with tests.",
        "CORS/security headers tightened; tests cover allowed/blocked origins.",
        "Secret/config audit documented with remediation steps."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/"
        ],
        "read_only_context": [
          "backend/config/"
        ]
      }
    },
    {
      "id": "hardening-perf-tuning",
      "description": "Profile and tune performance for search and batch endpoints; add load-test script and thresholds.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["search", "batch"],
      "acceptance_criteria": [
        "Search and batch endpoints meet defined latency targets under load.",
        "Indexes/caching added where needed; load-test script documents thresholds.",
        "Performance regressions covered by tests or CI checks."
      ],
      "scope": {
        "paths": [
          "backend/app/",
          "backend/tests/",
          "scripts/"
        ],
        "read_only_context": [
          "backend/db/"
        ]
      }
    },
    {
      "id": "hardening-deploy-verify",
      "description": "Finalize deployment assets and validate end-to-end run: docker-compose up, deploy.sh, and a smoke script to verify API/auth/search/batch are reachable.",
      "task_category": "deployment",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "features": ["deploy", "auth", "search", "batch", "frontend"],
      "acceptance_criteria": [
        "docker-compose.yml and deploy.sh start backend+frontend+db successfully.",
        "Smoke script hits auth/login, search endpoint, and batch upload endpoint with healthy responses.",
        ".dockerignore excludes transient artifacts."
      ],
      "scope": {
        "paths": [
          "docker-compose.yml",
          "deploy.sh",
          "backend/Dockerfile",
          "frontend/package.json",
          "scripts/verify_e2e_8100.py"
        ],
        "read_only_context": [
          "backend/",
          "frontend/"
        ]
      }
    },
    {
      "id": "hardening-docs-final",
      "description": "Update README/docs to reflect completed auth/search/batch features, deployment steps, and smoke instructions.",
      "task_category": "docs",
      "complexity": "low",
      "features": ["docs"],
      "acceptance_criteria": [
        "README documents auth flows, advanced search, batch upload, and deployment steps.",
        "Architecture diagrams include routing layer and new endpoints.",
        "No broken links or missing anchors in docs/."
      ],
      "scope": {
        "paths": [
          "README.md",
          "docs/"
        ]
      }
    },
    {
      "id": "hardening-planning-fortify",
      "description": "Fortify planning: reusable multi-agent planning harness (research/analysis/question-collection) to propose standard hardening phases for new projects.",
      "task_category": "docs",
      "complexity": "medium",
      "features": ["planning"],
      "acceptance_criteria": [
        "Planning harness documented and scripted to surface reusable hardening phases.",
        "Trigger instructions provided for new project plans (from scratch or mid-run).",
        "Outputs compiled for second-review with clear inclusion criteria."
      ],
      "scope": {
        "paths": [
          "docs/",
          "scripts/"
        ]
      }
    }
  ]
}
