{
  "phases": [
    {
      "id": "fileorg-p2-test-fixes",
      "description": "Stabilize the backend test suite by resolving dependency pin conflicts (fastapi/starlette/httpx), updating pytest.ini as needed, and ensuring all backend tests execute cleanly.",
      "task_category": "tests",
      "complexity": "low",
      "acceptance_criteria": [
        "All backend tests pass without dependency errors.",
        "requirements.txt pinned to compatible versions for fastapi/starlette/httpx/pytest.",
        "pytest.ini configured appropriately (asyncio mode, warnings)."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/tests/",
          "fileorganizer/backend/requirements.txt",
          "fileorganizer/backend/pytest.ini"
        ],
        "read_only_context": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/models/",
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-frontend-build",
      "description": "Set up and verify the frontend build system: install dependencies, produce a production build, and validate Electron packaging output.",
      "task_category": "frontend",
      "complexity": "low",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "npm/yarn install succeeds and locks are updated.",
        "Production build artifacts generated (dist/ or equivalent).",
        "Electron package builds successfully for distribution."
      ],
      "scope": {
        "paths": [
          "fileorganizer/frontend/package.json",
          "fileorganizer/frontend/src/",
          "fileorganizer/frontend/vite.config.ts",
          "fileorganizer/frontend/tsconfig.json",
          "fileorganizer/frontend/tsconfig.node.json",
          "fileorganizer/frontend/tailwind.config.js",
          "fileorganizer/frontend/postcss.config.js",
          "fileorganizer/frontend/index.html",
          "fileorganizer/frontend/electron/main.js",
          "fileorganizer/frontend/electron/preload.js",
          "fileorganizer/frontend/.gitignore"
        ],
        "read_only_context": [
          "fileorganizer/frontend/src/",
          "fileorganizer/frontend/package-lock.json"
        ]
      }
    },
    {
      "id": "fileorg-p2-docker",
      "description": "Add Docker deployment assets covering backend and frontend: Dockerfile, docker-compose.yml, .dockerignore, deploy.sh, and smoke-test the stack locally.",
      "task_category": "deployment",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "change_size": "large_refactor",
      "acceptance_criteria": [
        "Backend Dockerfile builds successfully (Python 3.11, dependencies installed).",
        "docker-compose.yml brings up backend + frontend (and db if needed).",
        ".dockerignore excludes venv/node_modules/build artifacts.",
        "deploy.sh runs the compose stack or equivalent automation.",
        "Local docker run verified with a basic health/smoke check."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/Dockerfile",
          "fileorganizer/docker-compose.yml",
          "fileorganizer/deploy.sh",
          "fileorganizer/.dockerignore"
        ],
        "read_only_context": [
          "fileorganizer/backend/",
          "fileorganizer/frontend/"
        ]
      }
    },
    {
      "id": "fileorg-p2-country-uk",
      "description": "Create UK-specific pack templates for tax and immigration, plus tests and docs updates.",
      "task_category": "backend",
      "complexity": "medium",
      "allow_mass_addition": true,
      "acceptance_criteria": [
        "tax_uk.yaml contains UK-specific categories/keywords.",
        "immigration_uk.yaml captures UK visa requirements.",
        "Pack loading tests cover UK packs.",
        "User guide updated for UK packs."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/packs/tax_uk.yaml",
          "fileorganizer/backend/packs/immigration_uk.yaml",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/packs/",
          "fileorganizer/docs/research/"
        ]
      }
    },
    {
      "id": "fileorg-p2-country-canada",
      "description": "Add Canada-specific pack templates for tax and immigration with validation tests and docs.",
      "task_category": "backend",
      "complexity": "medium",
      "allow_mass_addition": true,
      "acceptance_criteria": [
        "tax_canada.yaml captures Canadian tax categories.",
        "immigration_canada.yaml reflects Canadian visa requirements.",
        "Pack loading tests include Canada packs.",
        "User guide updated for Canada packs."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/packs/tax_canada.yaml",
          "fileorganizer/backend/packs/immigration_canada.yaml",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/packs/",
          "fileorganizer/docs/research/"
        ]
      }
    },
    {
      "id": "fileorg-p2-country-australia",
      "description": "Add Australia-specific pack templates for tax and immigration with validation tests and docs.",
      "task_category": "backend",
      "complexity": "medium",
      "allow_mass_addition": true,
      "acceptance_criteria": [
        "tax_australia.yaml captures Australian tax categories.",
        "immigration_australia.yaml reflects Australian visa requirements.",
        "Pack loading tests include Australia packs.",
        "User guide updated for Australia packs."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/packs/tax_australia.yaml",
          "fileorganizer/backend/packs/immigration_australia.yaml",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/packs/",
          "fileorganizer/docs/research/"
        ]
      }
    },
    {
      "id": "fileorg-p2-search",
      "description": "Implement advanced search and filtering: add FTS5 indexing, multi-field queries, filters (date, confidence), exports, and frontend UI for advanced search.",
      "task_category": "backend",
      "complexity": "medium",
      "change_size": "large_refactor",
      "builder_mode": "structured_edit",
      "ci": {
        "log_on_success": true
      },
      "acceptance_criteria": [
        "Backend FTS5 index on documents with multi-field search.",
        "API exposes advanced search with date/confidence filters and export.",
        "Frontend advanced search UI integrated.",
        "Tests validate search queries and filtering."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/models/"
        ]
      }
    },
    {
      "id": "fileorg-p2-batch-upload",
      "description": "Implement batch upload & processing with background job queue, progress tracking, batch classification, and frontend drag-and-drop UI.",
      "task_category": "backend",
      "complexity": "medium",
      "change_size": "large_refactor",
      "builder_mode": "structured_edit",
      "ci": {
        "log_on_success": true
      },
      "acceptance_criteria": [
        "Backend batch upload endpoint with job queue and progress tracking.",
        "Batch classification endpoint returns per-file status.",
        "Frontend supports multi-file drag-and-drop and progress indicators.",
        "Concurrent upload tests cover success/failure cases."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/models/"
        ]
      }
    },
    {
      "id": "fileorg-p2-auth",
      "description": "Add user authentication and multi-user support with JWTs, user-owned documents, protected routes, and migrations, plus frontend login/register flows.",
      "task_category": "backend",
      "complexity": "high",
      "change_size": "large_refactor",
      "acceptance_criteria": [
        "Backend user model, auth endpoints, and JWT token management in place.",
        "Document ownership enforced via user_id relationships and migrations.",
        "Frontend login/register UI and protected routes working.",
        "Auth flow tests and database migration scripts added."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/models/",
          "fileorganizer/backend/tests/",
          "fileorganizer/backend/migrations/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-qa-hardening",
      "description": "Resolve auditor needs_review findings across completed phases, rerun full CI, and add targeted tests for new search/batch/auth features.",
      "task_category": "tests",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "ci": {
        "log_on_success": true
      },
      "acceptance_criteria": [
        "Auditor issues from prior phases addressed or justified in-line.",
        "Full backend/frontend test suite passes (including new search/batch/auth tests).",
        "At least one end-to-end smoke covering search and batch upload passes."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/models/",
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-deploy-verify",
      "description": "Finalize deployment assets and validate end-to-end run: docker-compose up, deploy.sh, and a smoke script to verify API/auth/search/batch are reachable.",
      "task_category": "deployment",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "docker-compose.yml and deploy.sh start backend+frontend+db successfully.",
        "Smoke script hits auth/login, search endpoint, and batch upload endpoint with healthy responses.",
        ".dockerignore excludes transient artifacts (venv/node_modules/dist)."
      ],
      "scope": {
        "paths": [
          "fileorganizer/docker-compose.yml",
          "fileorganizer/deploy.sh",
          "fileorganizer/backend/Dockerfile",
          "fileorganizer/frontend/package.json",
          "scripts/verify_e2e_8100.py"
        ],
        "read_only_context": [
          "fileorganizer/backend/",
          "fileorganizer/frontend/"
        ]
      }
    },
    {
      "id": "fileorg-p2-docs-final",
      "description": "Update README and docs to reflect completed auth/search/batch features, deployment steps, and smoke instructions.",
      "task_category": "docs",
      "complexity": "low",
      "acceptance_criteria": [
        "README documents auth flows, advanced search, batch upload, and deployment steps.",
        "Any architecture diagrams include LlmService/control plane and new endpoints.",
        "No broken links or missing anchors in docs/."
      ],
      "scope": {
        "paths": [
          "README.md",
          "docs/"
        ]
      }
    },
    {
      "id": "fileorg-p2-auth-hardening",
      "description": "Harden authentication: RBAC, password reset/verification hooks, protected routes, logout/session handling, and auth E2E coverage.",
      "task_category": "backend",
      "complexity": "high",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "RBAC (admin/user) enforced on sensitive routes; logout/session handled.",
        "Password reset and email verification hooks present (stubbed if external service not configured).",
        "Frontend login/register/reset flows covered by tests; protected routes enforced.",
        "Auth E2E tests pass for login/register/reset/protected pages."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/models/",
          "fileorganizer/backend/tests/",
          "fileorganizer/backend/migrations/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-search-quality",
      "description": "Improve search relevance and UX: tuning, pagination, facets, and E2E coverage for advanced search.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "ci": {
        "log_on_success": true
      },
      "acceptance_criteria": [
        "Search supports pagination, facets/filters, and relevance tuning (recency/category boosts).",
        "Exports and empty-state UX verified; E2E search tests with seeded fixtures pass.",
        "Indexes/caching added for acceptable latency."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/models/"
        ]
      }
    },
    {
      "id": "fileorg-p2-batch-observability",
      "description": "Add batch job observability: status endpoints, per-file errors, cancel/retry, structured logging/metrics, and E2E coverage.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "ci": {
        "log_on_success": true
      },
      "acceptance_criteria": [
        "Batch status endpoints expose progress/errors; cancel/retry supported.",
        "Structured logging/metrics for batches added.",
        "E2E tests cover success/failure/cancel paths."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/",
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-file-safety",
      "description": "Implement file safety: type/size enforcement, MIME sniffing, virus-scan stub, safe temp storage, and tests for blocked uploads.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Uploads enforce file type/size; MIME sniffing guards added.",
        "Virus-scan hook/stub integrated; unsafe files blocked with clear errors.",
        "Tests cover blocked uploads and quarantine paths."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/uploads/",
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-storage-config",
      "description": "Abstract storage (local/S3), add presigned URL support, and document configuration/migration steps.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Storage layer supports local and S3 via config; presigned URLs available for uploads/downloads.",
        "Migration/compatibility tests for localâ†’S3 paths added.",
        "Ops docs updated for storage configuration."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/backend/config/"
        ],
        "read_only_context": [
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-export-sharing",
      "description": "Enhance exports/sharing: filtered/batch exports, expiring share links, and audit trail for shares.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Filtered and batch exports supported; share links have expiry and audit trail.",
        "API/UI paths tested; audit records captured.",
        "Docs updated for sharing/exports behavior."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/"
        ]
      }
    },
    {
      "id": "fileorg-p2-ui-ux-polish",
      "description": "Polish UI/UX: accessibility, keyboard nav, loading/error states, responsive layouts, and toasts/validation for search/batch/auth flows.",
      "task_category": "frontend",
      "complexity": "low",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Key flows (auth/search/batch) have loading/error states and toasts/inline validation.",
        "Responsive layouts verified; basic a11y/keyboard navigation in place.",
        "Frontend tests cover the updated UI states."
      ],
      "scope": {
        "paths": [
          "fileorganizer/frontend/src/"
        ],
        "read_only_context": [
          "fileorganizer/frontend/package.json"
        ]
      }
    },
    {
      "id": "fileorg-p2-logging-metrics",
      "description": "Add structured logging and basic metrics (latency/counts/errors) for auth/search/batch; expose diagnostics in health endpoints.",
      "task_category": "backend",
      "complexity": "low",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Structured logs include request/phase IDs for auth/search/batch.",
        "Basic metrics recorded and surfaced via health/diagnostic endpoints.",
        "Tests confirm logging/metrics emit for key endpoints."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/services/"
        ]
      }
    },
    {
      "id": "fileorg-p2-backup-migrations",
      "description": "Validate migration ordering/rollback, add seed data for smoke envs, and document backup/restore procedure.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Migrations apply/rollback cleanly in sequence; ordering documented.",
        "Seed data (packs/users) available for smoke; tests cover migration safety.",
        "Backup/restore steps documented and smoke-tested."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/migrations/",
          "fileorganizer/backend/models/",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/"
        ]
      }
    },
    {
      "id": "fileorg-p2-e2e-smoke",
      "description": "Add an automated E2E smoke suite covering auth, upload/search, batch status, export, and logout.",
      "task_category": "tests",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "ci": {
        "log_on_success": true
      },
      "acceptance_criteria": [
        "E2E tests (API/UI) cover auth, upload/search, batch status, export, logout.",
        "Suite runs in CI with seeded data and passes.",
        "Failures produce saved artifacts/logs for debugging."
      ],
      "scope": {
        "paths": [
          "tests/",
          "scripts/"
        ],
        "read_only_context": [
          "fileorganizer/backend/",
          "fileorganizer/frontend/"
        ]
      }
    },
    {
      "id": "fileorg-p2-security-basics",
      "description": "Add security hardening: rate limiting on auth/upload/search, CORS/headers tightening, and secret/config audit.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Rate limiting applied to auth/upload/search endpoints with tests.",
        "CORS/security headers tightened; tests cover allowed/blocked origins.",
        "Secret/config audit documented with remediation steps."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/"
        ],
        "read_only_context": [
          "fileorganizer/backend/config/"
        ]
      }
    },
    {
      "id": "fileorg-p2-perf-tuning",
      "description": "Profile and tune performance for search and batch endpoints; add load-test script and thresholds.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Search and batch endpoints meet defined latency targets under load.",
        "Indexes/caching added where needed; load-test script documents thresholds.",
        "Performance regressions covered by tests or CI checks."
      ],
      "scope": {
        "paths": [
          "fileorganizer/backend/app/",
          "fileorganizer/backend/tests/",
          "scripts/"
        ],
        "read_only_context": [
          "fileorganizer/backend/db/"
        ]
      }
    },
    {
      "id": "fileorg-p2-planning-fortify",
      "description": "Fortify planning: reusable multi-agent planning harness (research/analysis/question-collection) to propose standard hardening phases for new projects.",
      "task_category": "docs",
      "complexity": "medium",
      "builder_mode": "structured_edit",
      "acceptance_criteria": [
        "Planning harness documented and scripted to surface reusable hardening phases (auth/search/batch/security/QA/deploy).",
        "Trigger instructions provided for new project plans (from scratch or mid-run).",
        "Outputs compiled for second-review with clear inclusion criteria."
      ],
      "scope": {
        "paths": [
          "docs/",
          "scripts/"
        ]
      }
    }
  ]
}

