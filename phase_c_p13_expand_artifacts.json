{
  "run": {
    "run_id": "autopack-onephase-p13-expand-artifact-substitution",
    "safety_profile": "normal",
    "run_scope": "multi_tier",
    "token_cap": 260000,
    "max_phases": 1,
    "max_duration_minutes": 90
  },
  "tiers": [
    {
      "tier_id": "T1",
      "tier_index": 0,
      "name": "P1.3 Token Savings",
      "description": "Expand artifact-first beyond read_only_context in a conservative, opt-in way."
    }
  ],
  "phases": [
    {
      "phase_id": "F1.p13-expand-artifacts",
      "phase_index": 0,
      "tier_id": "T1",
      "name": "Expand artifact-first substitution",
      "description": "Extend artifact-first substitution to additional safe contexts beyond scope.read_only_context. Examples: automatically pin run/tier/phase summaries as a small 'history pack' in context; optionally substitute large SOT docs (BUILD_HISTORY, BUILD_LOG) with their phase/tier summaries when referenced; apply only when artifact is smaller and clearly relevant. Must be opt-in via config/env and must never break scoped loading correctness.",
      "task_category": "backend",
      "complexity": "medium",
      "builder_mode": "default",
      "scope": {
        "paths": [
          "src/autopack/autonomous_executor.py",
          "src/autopack/artifact_loader.py",
          "src/autopack/file_layout.py",
          "src/autopack/config.py",
          "tests/autopack/test_artifact_first_summaries.py",
          "tests/autopack/test_artifact_history_pack.py"
        ],
        "read_only_context": [
          {
            "path": "docs/ARCHITECTURE.md",
            "reason": "Ensure behavior aligns with scope-first loading and does not broaden context unsafely."
          }
        ],
        "acceptance_criteria": [
          "A small 'history pack' (run/tier/phase summary artifacts) can be included in context in an opt-in manner without exceeding context budgets.",
          "Substitution rules remain conservative: only substitute when artifact exists and is smaller; always fall back to full file content.",
          "All substitutions are clearly logged/recorded with estimated token savings.",
          "New tests simulate .autonomous_runs artifacts and validate history pack inclusion + substitution + fallback."
        ],
        "test_cmd": "pytest -q tests/autopack/test_artifact_history_pack.py tests/autopack/test_artifact_first_summaries.py",
        "notes": [
          "Keep it opt-in (env/config flag) to avoid surprising behavior changes.",
          "Cap history pack size (e.g., <=10k chars) and cap number of artifacts included."
        ]
      }
    }
  ]
}
